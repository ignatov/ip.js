<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Simple image editor</title>
    <script src="lib/jquery-1.5.js"></script>
    <script src="lib/browser-detect.js"></script>
    <script src="lib/pixastic.custom.js"></script>
    <script src="lib/dilation.js"></script>
    <script src="lib/erosion.js"></script>

    <script type="text/javascript">
        function invert() {
            $("#image").pixastic("invert");
            cleanResult();
        }
        function dilation() {
            $("#image").pixastic("dilation");
            cleanResult();
        }
        function erosion() {
            $("#image").pixastic("erosion");
            cleanResult();
        }
        function reset() {
            Pixastic.revert(document.getElementById("image"));
            cleanResult();
        }
        function convertToPNG() {
            var canvas = document.getElementById("image");
            var context = canvas.getContext("2d");
            var img = canvas.toDataURL("image/png");
            $("#result").html('<img src=' + img + ' /><br />Right click the image and select "save as" in order to save it.');
        }
        function cleanResult() {
            $("#result").empty();
        }
        function readURI(input) {

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $(".hidden").hide();
                    img.src = e.target.result;
                    reset();
                    $('.hidden').show();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        $(document).ready(function () {
            BrowserDetect.init();
            if (BrowserDetect.browser === "Firefox")
                netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
        });
    </script>

    <style>
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<div id="container">
    <h1>Simple image editor</h1>

    <input type='file' onchange="readURI(this);"/>

    <div id="filters" class="hidden">
        <label><input type="button" onclick="invert();" value="Invert image"/></label>
        <label><input type="button" onclick="dilation();" value="Dilation image"/></label>
        <label><input type="button" onclick="erosion();" value="Erosion image"/></label>
        <label><input type="button" onclick="reset();" value="Reset"/></label>
    </div>

    <br/>
    <canvas id="image" class="hidden"></canvas>

    <script type="text/javascript">
        var can = document.getElementById('image');
        var ctx = can.getContext('2d');

        var img = new Image();
        img.onload = function() {
            can.width = img.width;
            can.height = img.height;
            ctx.drawImage(img, 0, 0, img.width, img.height);
        }
    </script>

    <br/>

    <label><input type="button" class="hidden" onclick="convertToPNG();" value="Convert to PNG"/></label>

    <div id="result"></div>
</div>

</body>
</html>